external ( = ) : int -> int -> bool = "="
external ( < ) : int -> int -> bool = "<"
external ( - ) : int -> int -> int = "-"
external ( + ) : int -> int -> int = "+"

effect Fail : unit -> bool

let rec loop_latent n =
    if n = 0 then
        #Fail ()
    else if n < 0 then
        #Fail ()
    else
        loop_latent (n - 1)

let latent_handler = handler
| val y -> y
| #Fail () k -> k true

let test_latent n =
    loop_latent n;;

with latent_handler handle (test_latent 100);;
